<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AccentGuard - Communication Confidence Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        .logo {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .tagline {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .recording-section {
            margin-bottom: 30px;
        }

        .record-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto 20px;
        }

        .record-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .record-btn.recording {
            background: #4ecdc4;
            animation: pulse 1.5s infinite;
        }

        .record-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .status {
            font-size: 1.1em;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        .transcription {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 100px;
            text-align: left;
            border: 2px dashed #ddd;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .transcription.active {
            border-color: #4ecdc4;
            background: #f0fffe;
        }

        .feedback {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .feedback h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .feedback-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid rgba(255,255,255,0.5);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #d63031;
        }

        .api-key-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #ffc107;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 1em;
        }

        .save-key-btn {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .demo-phrases {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        .demo-phrase {
            background: white;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .demo-phrase:hover {
            background: #f0f8ff;
        }

        .instructions {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
            border-left: 4px solid #4caf50;
        }

        .instructions h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üé§ AccentGuard</div>
        <div class="tagline">Your AI-powered communication confidence coach</div>
        
        
        
        <div class="api-key-section" style="display: none;">
            <h3>üîë API Setup</h3>
            <p>Enter your Google Gemini API key to get started:</p>
            <input type="password" id="apiKey" class="api-key-input" placeholder="Your Gemini API Key">
            <br>
            <button id="saveKey" class="save-key-btn">Save & Start</button>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                üí° <strong>Free to use:</strong> Get your API key at <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>
            </p>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="interview">üíº Interview</button>
            <button class="mode-btn" data-mode="presentation">üìä Presentation</button>
            <button class="mode-btn" data-mode="meeting">ü§ù Meeting</button>
        </div>

        <div class="recording-section">
            <button id="recordBtn" class="record-btn" disabled>
                üé§ Start Recording
            </button>
            <div id="status" class="status">Click "Save & Start" above to begin</div>
        </div>

        <div id="transcription" class="transcription">
            Your speech will appear here...
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>Analyzing your speech...</div>
        </div>

        <div id="feedback" class="feedback" style="display: none;">
            <h3>üí° Confidence Tips</h3>
            <div id="feedbackContent"></div>
        </div>

        <div class="demo-phrases">
            <h3>üéØ Try These Phrases</h3>
            <div class="demo-phrase" onclick="setDemoPhrase(this.textContent)">
                "Tell me about yourself and your experience."
            </div>
            <div class="demo-phrase" onclick="setDemoPhrase(this.textContent)">
                "I'd like to propose a new initiative for our team."
            </div>
            <div class="demo-phrase" onclick="setDemoPhrase(this.textContent)">
                "Our quarterly results show significant improvement."
            </div>
            <div class="demo-phrase" onclick="setDemoPhrase(this.textContent)">
                "I believe we should focus on customer satisfaction."
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let recognition;
        let isRecording = false;
        let currentMode = 'interview';
        let apiKey = 'AIzaSyBU_BFtL8sIuLRhAxj9vRtoCyMvtpujK5I'; //Gemini API key
        let lastTranscript = '';

        // Initialize  app
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpeechRecognition();
            setupEventListeners();
            loadApiKey();
        });

        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    console.log('Speech recognition started');
                    updateStatus('Listening... Speak naturally');
                };

                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    updateTranscription(finalTranscript, interimTranscript);
                    
                    // Send to Gemini when we have substantial new content
                    if (finalTranscript.length > lastTranscript.length + 10) {
                        lastTranscript = finalTranscript;
                        sendToGemini(finalTranscript);
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    updateStatus(`Error: ${event.error}`);
                };

                recognition.onend = function() {
                    if (isRecording) {
                        recognition.start();
                    }
                };
            } else {
                updateStatus('Speech recognition not supported in this browser. Please use Chrome or Edge.');
            }
        }

        function setupEventListeners() {
            // Mode selection
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentMode = this.dataset.mode;
                });
            });

            // Record button
            document.getElementById('recordBtn').addEventListener('click', toggleRecording);

            // API key save
            document.getElementById('saveKey').addEventListener('click', saveApiKey);
        }

        function loadApiKey() {
            // Check if we have a hardcoded API key (for demo purposes)
            if (apiKey && apiKey !== 'AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx') {
                document.getElementById('recordBtn').disabled = false;
                updateStatus('Ready to start recording!');
                return;
            }
            
            // Fallback to saved key
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKey').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                document.getElementById('recordBtn').disabled = false;
                document.querySelector('.api-key-section').style.display = 'none';
                updateStatus('Ready to start recording!');
            } else {
                // Show API key section if no key is available
                document.querySelector('.api-key-section').style.display = 'block';
                updateStatus('Please enter your API key to get started');
            }
        }

        function saveApiKey() {
            const keyInput = document.getElementById('apiKey');
            const key = keyInput.value.trim();
            
            if (!key) {
                alert('Please enter your Gemini API key');
                return;
            }

            apiKey = key;
            localStorage.setItem('gemini_api_key', key);
            
            document.querySelector('.api-key-section').style.display = 'none';
            document.getElementById('recordBtn').disabled = false;
            updateStatus('API key saved! Ready to start recording.');
        }

        function toggleRecording() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (recognition && apiKey) {
                isRecording = true;
                recognition.start();
                
                const btn = document.getElementById('recordBtn');
                btn.classList.add('recording');
                btn.innerHTML = '‚èπÔ∏è Stop Recording';
                
                document.getElementById('transcription').classList.add('active');
                document.getElementById('feedback').style.display = 'none';
                lastTranscript = '';
            }
        }

        function stopRecording() {
            isRecording = false;
            if (recognition) {
                recognition.stop();
            }
            
            const btn = document.getElementById('recordBtn');
            btn.classList.remove('recording');
            btn.innerHTML = 'üé§ Start Recording';
            
            document.getElementById('transcription').classList.remove('active');
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function updateTranscription(final, interim) {
            const transcriptionDiv = document.getElementById('transcription');
            const finalText = final || 'Your speech will appear here...';
            const interimText = interim ? ` <em>(${interim})</em>` : '';
            
            transcriptionDiv.innerHTML = `<strong>${finalText}</strong>${interimText}`;
        }

        async function sendToGemini(transcript) {
            if (!apiKey) return;

            showLoading(true);
            
            try {
                const prompt = generatePrompt(transcript, currentMode);
                console.log('Sending to Gemini:', prompt); // Debug log
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        }
                    })
                });

                console.log('Response status:', response.status); // Debug log
                
                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('API Error Response:', errorData);
                    throw new Error(`API Error: ${response.status} - ${errorData}`);
                }

                const data = await response.json();
                console.log('Gemini Response:', data); // Debug log
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const feedback = data.candidates[0].content.parts[0].text;
                    displayFeedback(feedback);
                } else if (data.error) {
                    throw new Error(`Gemini API Error: ${data.error.message}`);
                } else {
                    throw new Error('Unexpected response format from Gemini API');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                // Try fallback feedback if API fails
                const fallbackFeedback = generateFallbackFeedback(transcript, currentMode);
                displayFeedback(fallbackFeedback.join('\n'));
            } finally {
                showLoading(false);
            }
        }

        function generatePrompt(transcript, mode) {
            const modeContext = {
                interview: "professional interview setting where you need to make a strong impression",
                presentation: "business presentation to colleagues where you want to convey expertise",
                meeting: "team meeting discussion where you want to contribute effectively"
            };

            return `You are a direct, honest communication coach who provides constructive criticism to help people improve their professional speaking skills.

CONTEXT: The speaker is practicing for a ${modeContext[mode]}. Their speech: "${transcript}"

TASK: Provide 2-3 direct, actionable tips to help them communicate more effectively. Be specific about what needs improvement. Focus on:
- Clarity and pronunciation issues
- Pace and rhythm problems
- Confidence and delivery weaknesses
- Professional presentation gaps

FORMAT: Return only the tips as a simple list. Be direct but not mean. Point out specific areas for improvement.

EXAMPLES of good feedback:
- "You're speaking too quickly - slow down by 20% so listeners can follow your points"
- "The phrase 'um, like' appears 5 times - practice pausing instead of using filler words"
- "Your voice sounds hesitant - project more confidence by speaking louder and with conviction"
- "Your answer lacks structure - organize your thoughts with 'first, second, third'"

Be specific about what's wrong and how to fix it. Don't just be positive - give real feedback.`;
        }

        function generateFallbackFeedback(transcript, mode) {
            const tips = [];
            
            // Check for common communication patterns
            const wordCount = transcript.split(' ').length;
            const hasFillers = /um|uh|like|you know/i.test(transcript);
            const fillerCount = (transcript.match(/um|uh|like|you know/gi) || []).length;
            const hasPauses = transcript.includes('...') || transcript.includes('  ');
            
            // Length-based feedback (more critical)
            if (wordCount < 10) {
                tips.push("Your answer is too brief - expand with specific examples and details to demonstrate expertise");
            } else if (wordCount > 80) {
                tips.push("You're rambling - cut your response by 30% and focus on your 3 strongest points");
            } else if (wordCount < 20) {
                tips.push("Give more substance - add concrete examples or data to support your statements");
            }
            
            // Filler word feedback (more direct)
            if (hasFillers) {
                if (fillerCount > 3) {
                    tips.push(`You used filler words ${fillerCount} times - this makes you sound unprepared. Practice pausing instead.`);
                } else {
                    tips.push("You have filler words in your speech - eliminate 'um', 'uh', and 'like' for more professional delivery");
                }
            }
            
            // Pace and clarity feedback
            const sentences = transcript.split(/[.!?]+/).filter(s => s.trim().length > 0);
            if (sentences.length > 0) {
                const avgWordsPerSentence = wordCount / sentences.length;
                if (avgWordsPerSentence > 25) {
                    tips.push("Your sentences are too long and complex - break them into shorter, clearer statements");
                } else if (avgWordsPerSentence < 8) {
                    tips.push("You're speaking in fragments - combine related thoughts into complete sentences");
                }
            }
            
            // Mode-specific critical feedback
            if (mode === 'interview') {
                if (!transcript.toLowerCase().includes('i') && !transcript.toLowerCase().includes('my')) {
                    tips.push("You're not personalizing your answer - use 'I' statements and share specific experiences");
                }
            } else if (mode === 'presentation') {
                if (!/first|second|third|next|finally|in conclusion/i.test(transcript)) {
                    tips.push("Your presentation lacks structure - organize with clear transitions and numbered points");
                }
            } else if (mode === 'meeting') {
                if (!/we|our|team|collaborate|together/i.test(transcript)) {
                    tips.push("You're speaking only about yourself - include team perspective and collaborative language");
                }
            }
            
            // Ensure we always have at least one critical tip
            if (tips.length === 0) {
                tips.push("Your delivery needs work - practice speaking slower, louder, and with more conviction");
            }
            
            return tips;
        }

        function displayFeedback(feedback) {
            const feedbackDiv = document.getElementById('feedback');
            const contentDiv = document.getElementById('feedbackContent');
            
            // Split feedback into items and format
            const tips = feedback.split('\n').filter(tip => tip.trim().length > 0);
            
            contentDiv.innerHTML = tips.map(tip => 
                `<div class="feedback-item">${tip.replace(/^\d+\.?\s*[-‚Ä¢]\s*/, '').trim()}</div>`
            ).join('');
            
            feedbackDiv.style.display = 'block';
            feedbackDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(message) {
            const feedbackDiv = document.getElementById('feedback');
            const contentDiv = document.getElementById('feedbackContent');
            
            contentDiv.innerHTML = `<div class="error">${message}</div>`;
            feedbackDiv.style.display = 'block';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function setDemoPhrase(phrase) {
            document.getElementById('transcription').innerHTML = `<strong>${phrase}</strong>`;
            document.getElementById('transcription').classList.add('active');
            
            if (apiKey) {
                sendToGemini(phrase);
            } else {
                document.getElementById('feedback').style.display = 'none';
                updateStatus('Please set up your API key first to get feedback on demo phrases.');
            }
        }
    </script>
</body>
</html>
